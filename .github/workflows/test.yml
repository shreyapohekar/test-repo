# insecure-pattern-lab.yml  (LAB ONLY - do not use in production)
# PURPOSE: show the *pattern* that causes risk:
#   pull_request_target runs with base repo context (and can access secrets)
#   If the workflow then checks out PR HEAD and executes it, untrusted code can run with those secrets.
# THIS LAB REPLACES dangerous behavior with safe no-op verification steps.

name: Insecure Pattern Lab (PRIVATE TEST REPO)

on:
  pull_request_target:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  # Note: in a real repo overly-broad permissions are a risk. This is a demo.
  id-token: write

jobs:
  demo:
    runs-on: ubuntu-latest
    steps:
      - name: Show job context (safe)
        run: |
          echo "${{ secrets.TSC }}"
          echo "This is a LAB demonstrating a risky workflow pattern."
          echo "bad code"
          echo ${{ github.event.pull_request.title }}

          echo "-----------------------------seperation--------------------"
          echo "quoted pr title"
          echo "${{ github.event.pull_request.title }}"

          echo "----------------------------separation----------------------"
          echo "pr title description"
          echo ${{ github.event.pull_request.description }}
          echo "--------------------------------------------------------------"
          PR_TITLE="${{ github.event.pull_request.title}}"
          PR_TITLE1=${{ github.event.pull_request.title}}
          echo "case 1 $PR_TITLE"
          echo $PR_TITLE
          echo "case 3 $PR_TITLE1"
          echo PR_TITLE1
      - name: Checkout base (trusted)  # safe approach: checkout base if using pull_request_target
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.pull_request.base.repo.full_name }}
          ref: ${{ github.event.pull_request.base.ref }}
